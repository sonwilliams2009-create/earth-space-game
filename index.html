<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>ECHS KY Earth & Space Science</title>
<style>
body{margin:0;font-family:Arial;background:#000014;color:white;text-align:center;}
.screen{display:none;padding:30px;} #login{display:block;}
button,input,select{padding:10px;margin:10px;border-radius:8px;border:none;font-size:15px;}
button{background:orange;cursor:pointer;}
button:hover{background:white;color:black;}
.term-section{margin:15px 0;padding:10px;border:1px solid orange;border-radius:8px;}
</style>
</head>
<body>

<h1>üè´ ECHS KY Earth & Space Science</h1>
<button id="musicBtn">üîá Music OFF</button>

<!-- LOGIN -->
<div id="login" class="screen">
<h2>Student Login</h2>
<input id="studentName" placeholder="Username">
<input id="studentPin" placeholder="4-digit PIN">
<button onclick="studentLogin()">Login</button>

<h2>Teacher Login</h2>
<input id="teacherPass" type="password" placeholder="Password">
<button onclick="teacherLogin()">Login</button>
</div>

<!-- TEACHER DASHBOARD -->
<div id="dashboard" class="screen">
<h2>Teacher Dashboard</h2>

<h3>Add Student</h3>
<input id="newStudent" placeholder="Username">
<input id="newPin" placeholder="PIN (4 digits)">
<button onclick="addStudent()">Add Student</button>

<h3>Assign Units to Student</h3>
<select id="selectStudentDropdown" onchange="buildUnitList()"></select><br>
<select id="selectTermDropdown" onchange="buildUnitList()">
  <option value="term1">Term 1</option>
  <option value="term2">Term 2</option>
  <option value="term3">Term 3</option>
  <option value="term4">Term 4</option>
</select>
<div id="unitAssignList"></div>
<button onclick="saveAssignments()">Save Assignments</button>
<button onclick="resetStudentProgress()">Reset Student Progress</button>

<h3>Leaderboard</h3>
<div id="board"></div>

<button onclick="show('login')">Logout</button>
</div>

<!-- STUDENT MENU -->
<div id="studentMenu" class="screen">
<h2>Your Terms & Units</h2>
<div id="termButtons"></div>
<button onclick="show('login')">Logout</button>
</div>

<!-- UNIT GAME -->
<div id="game" class="screen">
<h2 id="unitTitle"></h2>
<p id="question"></p>
<div id="answers"></div>
</div>

<script>
/* ================= GLOBAL VARIABLES ================= */
let currentStudent="", currentTerm="", currentUnitKey="", currentUnitData=null, currentQuestionIndex=0, score=0;

/* ================= MENU MUSIC ================= */
let music = new Audio("menu-music.mp3"); music.loop=true; music.volume=0.3;
document.getElementById("musicBtn").onclick=function(){
  if(music.paused){ music.play().catch(()=>alert("Click to allow music")); this.innerText="üîä Music ON"; }
  else{ music.pause(); this.innerText="üîá Music OFF"; }
};

/* ================= UNITS ================= */
const courseUnits={
unit1:"Unit 1: Big Bang & Universe",
unit2:"Unit 2: Stars & Galaxies",
unit3:"Unit 3: Solar System & Planet Motion",
unit4:"Unit 4: Gravity & Orbital Mechanics",
unit5:"Unit 5: Earth Interior & Layers",
unit6:"Unit 6: Plate Tectonics",
unit7:"Unit 7: Earthquakes",
unit8:"Unit 8: Volcanoes & Mountains",
unit9:"Unit 9: Weather Systems",
unit10:"Unit 10: Climate Change",
unit11:"Unit 11: Oceans & Currents",
unit12:"Unit 12: Earth Resources",
unit13:"Unit 13: Human Impact",
unit14:"Unit 14: Moon & Tides",
unit15:"Unit 15: Space Exploration",
unit16:"Unit 16: Meteorology",
unit17:"Unit 17: Magnetic Field & Auroras",
unit18:"Unit 18: Rocks & Minerals",
unit19:"Unit 19: Geologic Time & Fossils",
unit20:"Unit 20: Final Review"
};

/* ================= TERMS ================= */
const terms = {
term1:["unit1","unit2","unit3","unit4","unit5"],
term2:["unit6","unit7","unit8","unit9","unit10"],
term3:["unit11","unit12","unit13","unit14","unit15"],
term4:["unit16","unit17","unit18","unit19","unit20"]
};

/* ================= QUESTIONS ================= */
const questionBank={
unit1:[{q:"The Big Bang explains‚Ä¶",a:[{text:"Origin of universe",correct:true},{text:"Oceans",correct:false}]},{q:"Universe age?",a:[{text:"13.8 billion years",correct:true},{text:"1 million years",correct:false}]},{q:"Galaxies are moving?",a:[{text:"Away from each other",correct:true},{text:"Toward each other",correct:false}]}],
unit2:[{q:"A light year measures‚Ä¶",a:[{text:"Distance",correct:true},{text:"Time",correct:false}]},{q:"The closest star to Earth?",a:[{text:"Sun",correct:true},{text:"Proxima Centauri",correct:false}]},{q:"Milky Way is a‚Ä¶",a:[{text:"Galaxy",correct:true},{text:"Star",correct:false}]}],
unit3:[{q:"Planets orbit the sun because‚Ä¶",a:[{text:"Gravity",correct:true},{text:"Magnetism",correct:false}]},{q:"Mars is known as‚Ä¶",a:[{text:"Red Planet",correct:true},{text:"Blue Planet",correct:false}]},{q:"Jupiter is‚Ä¶",a:[{text:"Gas giant",correct:true},{text:"Rocky planet",correct:false}]}],
unit4:[{q:"Gravity affects‚Ä¶",a:[{text:"All objects with mass",correct:true},{text:"Only planets",correct:false}]},{q:"Orbital motion depends on‚Ä¶",a:[{text:"Gravity & velocity",correct:true},{text:"Temperature",correct:false}]}],
unit5:[{q:"Earth‚Äôs magnetic field comes from‚Ä¶",a:[{text:"Outer core",correct:true},{text:"Crust",correct:false}]},{q:"Densest Earth layer is‚Ä¶",a:[{text:"Inner core",correct:true},{text:"Mantle",correct:false}]}],
unit6:[{q:"Plate tectonics explains‚Ä¶",a:[{text:"Continental movement",correct:true},{text:"Earthquakes only",correct:false}]},{q:"Plates move at‚Ä¶",a:[{text:"Centimeters per year",correct:true},{text:"Meters per year",correct:false}]}],
unit7:[{q:"Earthquakes occur at‚Ä¶",a:[{text:"Fault lines",correct:true},{text:"Volcanoes",correct:false}]},{q:"Richter scale measures‚Ä¶",a:[{text:"Magnitude",correct:true},{text:"Temperature",correct:false}]}],
unit8:[{q:"Volcanoes form at‚Ä¶",a:[{text:"Plate boundaries",correct:true},{text:"Mountains only",correct:false}]},{q:"Subduction occurs when‚Ä¶",a:[{text:"One plate goes under another",correct:true},{text:"Plates collide & stay",correct:false}]}],
unit9:[{q:"Weather is‚Ä¶",a:[{text:"Short-term atmosphere conditions",correct:true},{text:"Climate",correct:false}]},{q:"High pressure usually means‚Ä¶",a:[{text:"Clear skies",correct:true},{text:"Stormy weather",correct:false}]}],
unit10:[{q:"Climate is‚Ä¶",a:[{text:"Long-term patterns",correct:true},{text:"Daily weather",correct:false}]},{q:"Greenhouse gases contribute to‚Ä¶",a:[{text:"Global warming",correct:true},{text:"Cooling",correct:false}]}],
unit11:[{q:"Oceans influence climate by‚Ä¶",a:[{text:"Transporting heat",correct:true},{text:"Blocking wind",correct:false}]},{q:"Currents are caused by‚Ä¶",a:[{text:"Wind & temperature differences",correct:true},{text:"Earthquakes",correct:false}]}],
unit12:[{q:"Sustainable resources are‚Ä¶",a:[{text:"Not depleted",correct:true},{text:"Used quickly",correct:false}]},{q:"Renewable resources include‚Ä¶",a:[{text:"Solar energy",correct:true},{text:"Coal",correct:false}]}],
unit13:[{q:"Human activity affects‚Ä¶",a:[{text:"Climate & ecosystems",correct:true},{text:"Only rivers",correct:false}]},{q:"Pollution increases‚Ä¶",a:[{text:"Greenhouse gases",correct:true},{text:"Oxygen",correct:false}]}],
unit14:[{q:"Tides are caused by‚Ä¶",a:[{text:"Moon gravity",correct:true},{text:"Sunlight",correct:false}]},{q:"Lunar eclipse occurs when‚Ä¶",a:[{text:"Earth blocks sunlight to Moon",correct:true},{text:"Moon blocks Earth",correct:false}]}],
unit15:[{q:"Satellites orbit due to‚Ä¶",a:[{text:"Gravity",correct:true},{text:"Wind",correct:false}]},{q:"Space exploration helps‚Ä¶",a:[{text:"Study planets",correct:true},{text:"Predict earthquakes",correct:false}]}],
unit16:[{q:"Meteorology studies‚Ä¶",a:[{text:"Weather & atmosphere",correct:true},{text:"Rocks",correct:false}]},{q:"Severe storms include‚Ä¶",a:[{text:"Tornadoes",correct:true},{text:"Droughts",correct:false}]}],
unit17:[{q:"Auroras caused by‚Ä¶",a:[{text:"Solar wind & magnetic field",correct:true},{text:"Volcanoes",correct:false}]},{q:"Magnetic field protects‚Ä¶",a:[{text:"Life from solar radiation",correct:true},{text:"Wind",correct:false}]}],
unit18:[{q:"Rocks classified by‚Ä¶",a:[{text:"Formation",correct:true},{text:"Color only",correct:false}]},{q:"Rock cycle includes‚Ä¶",a:[{text:"Igneous, sedimentary, metamorphic",correct:true},{text:"Sand, clay",correct:false}]}],
unit19:[{q:"Fossils help determine‚Ä¶",a:[{text:"Earth history",correct:true},{text:"Weather patterns",correct:false}]},{q:"Geologic time scale measures‚Ä¶",a:[{text:"Earth history in years",correct:true},{text:"Daily temperature",correct:false}]}],
unit20:[{q:"Final review includes‚Ä¶",a:[{text:"All previous topics",correct:true},{text:"Only Unit1",correct:false}]},{q:"Exams test‚Ä¶",a:[{text:"Understanding",correct:true},{text:"Memory only",correct:false}]}]
};

/* ================= LOCALSTORAGE ================= */
function getStudents(){ return JSON.parse(localStorage.getItem("students")||"{}"); }
function saveStudents(obj){ localStorage.setItem("students",JSON.stringify(obj)); }

/* ================= SCREEN CONTROL ================= */
function show(id){ document.querySelectorAll(".screen").forEach(s=>s.style.display="none"); document.getElementById(id).style.display="block"; }

/* ================= TEACHER FUNCTIONS ================= */
function teacherLogin(){
  if(document.getElementById("teacherPass").value==="caves"){
    show("dashboard"); loadLeaderboard(); populateStudentDropdown(); buildUnitList();
  }else alert("Wrong password");
}

/* Add student */
function addStudent(){
  const name=document.getElementById("newStudent").value.trim();
  const pin=document.getElementById("newPin").value.trim();
  if(!name||!pin||pin.length!==4) return alert("Enter username & 4-digit PIN");
  let students=getStudents();
  if(students[name]) return alert("Username exists!");
  let allowed={},scores={term1:0,term2:0,term3:0,term4:0,total:0};
  for(let t in terms){ allowed[t]={}; terms[t].forEach(u=>allowed[t][u]=false); }
  students[name]={pin:pin,allowedUnits:allowed,scores:scores};
  saveStudents(students);
  alert("Student added: "+name);
  document.getElementById("newStudent").value=""; document.getElementById("newPin").value="";
  populateStudentDropdown(); buildUnitList(); loadLeaderboard();
}

/* Populate dropdown for teacher */
function populateStudentDropdown(){
  const select=document.getElementById("selectStudentDropdown");
  const students=getStudents();
  select.innerHTML="";
  if(Object.keys(students).length===0){
    select.innerHTML="<option value=''>No students</option>"; return;
  }
  for(let s in students){ select.innerHTML+=`<option value="${s}">${s}</option>`; }
}

/* Build unit list checkboxes for selected term */
function buildUnitList(){
  const student=document.getElementById("selectStudentDropdown").value;
  const selectedTerm=document.getElementById("selectTermDropdown").value;
  const div=document.getElementById("unitAssignList"); div.innerHTML="";
  if(!student) { div.innerHTML="Select a student first"; return; }
  const students=getStudents(); const studentData=students[student];
  let i=1;
  terms[selectedTerm].forEach(u=>{
    const checked=studentData.allowedUnits[selectedTerm][u]? "checked" : "";
    div.innerHTML+=`<label><input type="checkbox" id="unitCheck${i}" ${checked}> ${courseUnits[u]}</label><br>`;
    i++;
  });
}

/* Save assignments */
function saveAssignments(){
  const student=document.getElementById("selectStudentDropdown").value;
  const selectedTerm=document.getElementById("selectTermDropdown").value;
  if(!student) return alert("Select student");
  let students=getStudents(); let i=1;
  terms[selectedTerm].forEach(u=>{ students[student].allowedUnits[selectedTerm][u]=document.getElementById("unitCheck"+i).checked; i++; });
  saveStudents(students); alert("Assignments saved!"); buildUnitList();
}

/* Reset student progress */
function resetStudentProgress(){
  const student=document.getElementById("selectStudentDropdown").value;
  if(!student) return alert("Select student");
  let students=getStudents();
  students[student].scores={term1:0,term2:0,term3:0,term4:0,total:0};
  for(let t in terms){ terms[t].forEach(u=>students[student].allowedUnits[t][u]=false); }
  saveStudents(students); alert("Progress reset!"); buildUnitList(); loadLeaderboard();
}

/* ================= STUDENT FUNCTIONS ================= */
function studentLogin(){
  const name=document.getElementById("studentName").value.trim();
  const pin=document.getElementById("studentPin").value.trim();
  if(!name||!pin) return alert("Enter username & PIN");
  const students=getStudents();
  if(!students[name]) return alert("Student not found!");
  if(students[name].pin!==pin) return alert("Incorrect PIN!");
  currentStudent=name; show("studentMenu"); loadStudentTerms();
}

/* Load student terms buttons */
function loadStudentTerms(){
  const div=document.getElementById("termButtons"); div.innerHTML="";
  const students=getStudents(); const studentData=students[currentStudent];
  for(let t in terms){
    const hasUnits=Object.values(studentData.allowedUnits[t]).some(v=>v);
    if(hasUnits){
      const btn=document.createElement("button");
      btn.className="term-section"; btn.innerText=`${t.toUpperCase()} Units`; btn.onclick=()=>loadTermUnits(t);
      div.appendChild(btn);
    }
  }
}

/* Load units per term */
function loadTermUnits(term){
  currentTerm=term; const div=document.getElementById("termButtons"); div.innerHTML="";
  const students=getStudents(); const studentData=students[currentStudent];
  terms[term].forEach(u=>{
    if(studentData.allowedUnits[term][u]){
      const btn=document.createElement("button"); btn.innerText=courseUnits[u]; btn.onclick=()=>startUnit(u); div.appendChild(btn);
    }
  });
  const back=document.createElement("button"); back.innerText="Back to Terms"; back.onclick=loadStudentTerms; div.appendChild(back);
}

/* ================= GAME ================= */
function startUnit(u){
  if(!questionBank[u]) return alert("No questions yet");
  currentUnitKey=u; currentUnitData=questionBank[u]; currentQuestionIndex=0; score=0;
  show("game"); showQuestion();
}

function showQuestion(){
  const q=currentUnitData[currentQuestionIndex];
  document.getElementById("unitTitle").innerText=courseUnits[currentUnitKey];
  document.getElementById("question").innerText=q.q;
  const div=document.getElementById("answers"); div.innerHTML="";
  shuffle(q.a); q.a.forEach(ans=>{ const btn=document.createElement("button"); btn.innerText=ans.text; btn.onclick=()=>checkAnswer(ans.correct); div.appendChild(btn); });
}

function checkAnswer(correct){
  if(correct) score+=20; currentQuestionIndex++;
  if(currentQuestionIndex<currentUnitData.length) showQuestion();
  else{
    const students=getStudents(); 
    students[currentStudent].scores[currentTerm]+=score;
    students[currentStudent].scores.total+=score;
    saveStudents(students); alert(`Unit complete! Score: ${score}`);
    show("studentMenu"); loadStudentTerms();
  }
}

/* ================= LEADERBOARD ================= */
function loadLeaderboard(){
  const div=document.getElementById("board"); div.innerHTML="";
  const students=getStudents(); 
  let arr=Object.keys(students).map(name=>({name,score:students[name].scores.total}));
  arr.sort((a,b)=>b.score-a.score);
  arr.forEach(s=>{ div.innerHTML+=`üèÜ ${s.name} : ${s.score} points<br>`; });
}

/* ================= SHUFFLE ================= */
function shuffle(array){ for(let i=array.length-1;i>0;i--){ const j=Math.floor(Math.random()*(i+1)); [array[i],array[j]]=[array[j],array[i]]; } }

</script>
</body>
</html>
<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>ECHS KY Earth & Space Science</title>
<style>
body{margin:0;font-family:Arial;background:#000014;color:white;text-align:center;}
.screen{display:none;padding:30px;} #login{display:block;}
button,input,select{padding:10px;margin:10px;border-radius:8px;border:none;font-size:15px;}
button{background:orange;cursor:pointer;}
button:hover{background:white;color:black;}
.term-section{margin:15px 0;padding:10px;border:1px solid orange;border-radius:8px;}
</style>
</head>
<body>

<h1>üè´ ECHS KY Earth & Space Science</h1>
<button id="musicBtn">üîá Music OFF</button>

<!-- LOGIN -->
<div id="login" class="screen">
<h2>Student Login</h2>
<input id="studentName" placeholder="Username">
<input id="studentPin" placeholder="4-digit PIN">
<button onclick="studentLogin()">Login</button>

<h2>Teacher Login</h2>
<input id="teacherPass" type="password" placeholder="Password">
<button onclick="teacherLogin()">Login</button>
</div>

<!-- TEACHER DASHBOARD -->
<div id="dashboard" class="screen">
<h2>Teacher Dashboard</h2>

<h3>Add Student</h3>
<input id="newStudent" placeholder="Username">
<input id="newPin" placeholder="PIN (4 digits)">
<button onclick="addStudent()">Add Student</button>

<h3>Assign Units to Student</h3>
<select id="selectStudentDropdown" onchange="buildUnitList()"></select><br>
<select id="selectTermDropdown" onchange="buildUnitList()">
  <option value="term1">Term 1</option>
  <option value="term2">Term 2</option>
  <option value="term3">Term 3</option>
  <option value="term4">Term 4</option>
</select>
<div id="unitAssignList"></div>
<button onclick="saveAssignments()">Save Assignments</button>
<button onclick="resetStudentProgress()">Reset Student Progress</button>

<h3>Leaderboard</h3>
<div id="board"></div>

<button onclick="show('login')">Logout</button>
</div>

<!-- STUDENT MENU -->
<div id="studentMenu" class="screen">
<h2>Your Terms & Units</h2>
<div id="termButtons"></div>
<button onclick="show('login')">Logout</button>
</div>

<!-- UNIT GAME -->
<div id="game" class="screen">
<h2 id="unitTitle"></h2>
<p id="question"></p>
<div id="answers"></div>
</div>

<script>
/* ================= GLOBAL VARIABLES ================= */
let currentStudent="", currentTerm="", currentUnitKey="", currentUnitData=null, currentQuestionIndex=0, score=0;

/* ================= MENU MUSIC ================= */
let music = new Audio("menu-music.mp3"); music.loop=true; music.volume=0.3;
document.getElementById("musicBtn").onclick=function(){
  if(music.paused){ music.play().catch(()=>alert("Click to allow music")); this.innerText="üîä Music ON"; }
  else{ music.pause(); this.innerText="üîá Music OFF"; }
};

/* ================= UNITS ================= */
const courseUnits={
unit1:"Unit 1: Big Bang & Universe",
unit2:"Unit 2: Stars & Galaxies",
unit3:"Unit 3: Solar System & Planet Motion",
unit4:"Unit 4: Gravity & Orbital Mechanics",
unit5:"Unit 5: Earth Interior & Layers",
unit6:"Unit 6: Plate Tectonics",
unit7:"Unit 7: Earthquakes",
unit8:"Unit 8: Volcanoes & Mountains",
unit9:"Unit 9: Weather Systems",
unit10:"Unit 10: Climate Change",
unit11:"Unit 11: Oceans & Currents",
unit12:"Unit 12: Earth Resources",
unit13:"Unit 13: Human Impact",
unit14:"Unit 14: Moon & Tides",
unit15:"Unit 15: Space Exploration",
unit16:"Unit 16: Meteorology",
unit17:"Unit 17: Magnetic Field & Auroras",
unit18:"Unit 18: Rocks & Minerals",
unit19:"Unit 19: Geologic Time & Fossils",
unit20:"Unit 20: Final Review"
};

/* ================= TERMS ================= */
const terms = {
term1:["unit1","unit2","unit3","unit4","unit5"],
term2:["unit6","unit7","unit8","unit9","unit10"],
term3:["unit11","unit12","unit13","unit14","unit15"],
term4:["unit16","unit17","unit18","unit19","unit20"]
};

/* ================= QUESTIONS ================= */
const questionBank={
unit1:[{q:"The Big Bang explains‚Ä¶",a:[{text:"Origin of universe",correct:true},{text:"Oceans",correct:false}]},{q:"Universe age?",a:[{text:"13.8 billion years",correct:true},{text:"1 million years",correct:false}]},{q:"Galaxies are moving?",a:[{text:"Away from each other",correct:true},{text:"Toward each other",correct:false}]}],
unit2:[{q:"A light year measures‚Ä¶",a:[{text:"Distance",correct:true},{text:"Time",correct:false}]},{q:"The closest star to Earth?",a:[{text:"Sun",correct:true},{text:"Proxima Centauri",correct:false}]},{q:"Milky Way is a‚Ä¶",a:[{text:"Galaxy",correct:true},{text:"Star",correct:false}]}],
unit3:[{q:"Planets orbit the sun because‚Ä¶",a:[{text:"Gravity",correct:true},{text:"Magnetism",correct:false}]},{q:"Mars is known as‚Ä¶",a:[{text:"Red Planet",correct:true},{text:"Blue Planet",correct:false}]},{q:"Jupiter is‚Ä¶",a:[{text:"Gas giant",correct:true},{text:"Rocky planet",correct:false}]}],
unit4:[{q:"Gravity affects‚Ä¶",a:[{text:"All objects with mass",correct:true},{text:"Only planets",correct:false}]},{q:"Orbital motion depends on‚Ä¶",a:[{text:"Gravity & velocity",correct:true},{text:"Temperature",correct:false}]}],
unit5:[{q:"Earth‚Äôs magnetic field comes from‚Ä¶",a:[{text:"Outer core",correct:true},{text:"Crust",correct:false}]},{q:"Densest Earth layer is‚Ä¶",a:[{text:"Inner core",correct:true},{text:"Mantle",correct:false}]}],
unit6:[{q:"Plate tectonics explains‚Ä¶",a:[{text:"Continental movement",correct:true},{text:"Earthquakes only",correct:false}]},{q:"Plates move at‚Ä¶",a:[{text:"Centimeters per year",correct:true},{text:"Meters per year",correct:false}]}],
unit7:[{q:"Earthquakes occur at‚Ä¶",a:[{text:"Fault lines",correct:true},{text:"Volcanoes",correct:false}]},{q:"Richter scale measures‚Ä¶",a:[{text:"Magnitude",correct:true},{text:"Temperature",correct:false}]}],
unit8:[{q:"Volcanoes form at‚Ä¶",a:[{text:"Plate boundaries",correct:true},{text:"Mountains only",correct:false}]},{q:"Subduction occurs when‚Ä¶",a:[{text:"One plate goes under another",correct:true},{text:"Plates collide & stay",correct:false}]}],
unit9:[{q:"Weather is‚Ä¶",a:[{text:"Short-term atmosphere conditions",correct:true},{text:"Climate",correct:false}]},{q:"High pressure usually means‚Ä¶",a:[{text:"Clear skies",correct:true},{text:"Stormy weather",correct:false}]}],
unit10:[{q:"Climate is‚Ä¶",a:[{text:"Long-term patterns",correct:true},{text:"Daily weather",correct:false}]},{q:"Greenhouse gases contribute to‚Ä¶",a:[{text:"Global warming",correct:true},{text:"Cooling",correct:false}]}],
unit11:[{q:"Oceans influence climate by‚Ä¶",a:[{text:"Transporting heat",correct:true},{text:"Blocking wind",correct:false}]},{q:"Currents are caused by‚Ä¶",a:[{text:"Wind & temperature differences",correct:true},{text:"Earthquakes",correct:false}]}],
unit12:[{q:"Sustainable resources are‚Ä¶",a:[{text:"Not depleted",correct:true},{text:"Used quickly",correct:false}]},{q:"Renewable resources include‚Ä¶",a:[{text:"Solar energy",correct:true},{text:"Coal",correct:false}]}],
unit13:[{q:"Human activity affects‚Ä¶",a:[{text:"Climate & ecosystems",correct:true},{text:"Only rivers",correct:false}]},{q:"Pollution increases‚Ä¶",a:[{text:"Greenhouse gases",correct:true},{text:"Oxygen",correct:false}]}],
unit14:[{q:"Tides are caused by‚Ä¶",a:[{text:"Moon gravity",correct:true},{text:"Sunlight",correct:false}]},{q:"Lunar eclipse occurs when‚Ä¶",a:[{text:"Earth blocks sunlight to Moon",correct:true},{text:"Moon blocks Earth",correct:false}]}],
unit15:[{q:"Satellites orbit due to‚Ä¶",a:[{text:"Gravity",correct:true},{text:"Wind",correct:false}]},{q:"Space exploration helps‚Ä¶",a:[{text:"Study planets",correct:true},{text:"Predict earthquakes",correct:false}]}],
unit16:[{q:"Meteorology studies‚Ä¶",a:[{text:"Weather & atmosphere",correct:true},{text:"Rocks",correct:false}]},{q:"Severe storms include‚Ä¶",a:[{text:"Tornadoes",correct:true},{text:"Droughts",correct:false}]}],
unit17:[{q:"Auroras caused by‚Ä¶",a:[{text:"Solar wind & magnetic field",correct:true},{text:"Volcanoes",correct:false}]},{q:"Magnetic field protects‚Ä¶",a:[{text:"Life from solar radiation",correct:true},{text:"Wind",correct:false}]}],
unit18:[{q:"Rocks classified by‚Ä¶",a:[{text:"Formation",correct:true},{text:"Color only",correct:false}]},{q:"Rock cycle includes‚Ä¶",a:[{text:"Igneous, sedimentary, metamorphic",correct:true},{text:"Sand, clay",correct:false}]}],
unit19:[{q:"Fossils help determine‚Ä¶",a:[{text:"Earth history",correct:true},{text:"Weather patterns",correct:false}]},{q:"Geologic time scale measures‚Ä¶",a:[{text:"Earth history in years",correct:true},{text:"Daily temperature",correct:false}]}],
unit20:[{q:"Final review includes‚Ä¶",a:[{text:"All previous topics",correct:true},{text:"Only Unit1",correct:false}]},{q:"Exams test‚Ä¶",a:[{text:"Understanding",correct:true},{text:"Memory only",correct:false}]}]
};

/* ================= LOCALSTORAGE ================= */
function getStudents(){ return JSON.parse(localStorage.getItem("students")||"{}"); }
function saveStudents(obj){ localStorage.setItem("students",JSON.stringify(obj)); }

/* ================= SCREEN CONTROL ================= */
function show(id){ document.querySelectorAll(".screen").forEach(s=>s.style.display="none"); document.getElementById(id).style.display="block"; }

/* ================= TEACHER FUNCTIONS ================= */
function teacherLogin(){
  if(document.getElementById("teacherPass").value==="caves"){
    show("dashboard"); loadLeaderboard(); populateStudentDropdown(); buildUnitList();
  }else alert("Wrong password");
}

/* Add student */
function addStudent(){
  const name=document.getElementById("newStudent").value.trim();
  const pin=document.getElementById("newPin").value.trim();
  if(!name||!pin||pin.length!==4) return alert("Enter username & 4-digit PIN");
  let students=getStudents();
  if(students[name]) return alert("Username exists!");
  let allowed={},scores={term1:0,term2:0,term3:0,term4:0,total:0};
  for(let t in terms){ allowed[t]={}; terms[t].forEach(u=>allowed[t][u]=false); }
  students[name]={pin:pin,allowedUnits:allowed,scores:scores};
  saveStudents(students);
  alert("Student added: "+name);
  document.getElementById("newStudent").value=""; document.getElementById("newPin").value="";
  populateStudentDropdown(); buildUnitList(); loadLeaderboard();
}

/* Populate dropdown for teacher */
function populateStudentDropdown(){
  const select=document.getElementById("selectStudentDropdown");
  const students=getStudents();
  select.innerHTML="";
  if(Object.keys(students).length===0){
    select.innerHTML="<option value=''>No students</option>"; return;
  }
  for(let s in students){ select.innerHTML+=`<option value="${s}">${s}</option>`; }
}

/* Build unit list checkboxes for selected term */
function buildUnitList(){
  const student=document.getElementById("selectStudentDropdown").value;
  const selectedTerm=document.getElementById("selectTermDropdown").value;
  const div=document.getElementById("unitAssignList"); div.innerHTML="";
  if(!student) { div.innerHTML="Select a student first"; return; }
  const students=getStudents(); const studentData=students[student];
  let i=1;
  terms[selectedTerm].forEach(u=>{
    const checked=studentData.allowedUnits[selectedTerm][u]? "checked" : "";
    div.innerHTML+=`<label><input type="checkbox" id="unitCheck${i}" ${checked}> ${courseUnits[u]}</label><br>`;
    i++;
  });
}

/* Save assignments */
function saveAssignments(){
  const student=document.getElementById("selectStudentDropdown").value;
  const selectedTerm=document.getElementById("selectTermDropdown").value;
  if(!student) return alert("Select student");
  let students=getStudents(); let i=1;
  terms[selectedTerm].forEach(u=>{ students[student].allowedUnits[selectedTerm][u]=document.getElementById("unitCheck"+i).checked; i++; });
  saveStudents(students); alert("Assignments saved!"); buildUnitList();
}

/* Reset student progress */
function resetStudentProgress(){
  const student=document.getElementById("selectStudentDropdown").value;
  if(!student) return alert("Select student");
  let students=getStudents();
  students[student].scores={term1:0,term2:0,term3:0,term4:0,total:0};
  for(let t in terms){ terms[t].forEach(u=>students[student].allowedUnits[t][u]=false); }
  saveStudents(students); alert("Progress reset!"); buildUnitList(); loadLeaderboard();
}

/* ================= STUDENT FUNCTIONS ================= */
function studentLogin(){
  const name=document.getElementById("studentName").value.trim();
  const pin=document.getElementById("studentPin").value.trim();
  if(!name||!pin) return alert("Enter username & PIN");
  const students=getStudents();
  if(!students[name]) return alert("Student not found!");
  if(students[name].pin!==pin) return alert("Incorrect PIN!");
  currentStudent=name; show("studentMenu"); loadStudentTerms();
}

/* Load student terms buttons */
function loadStudentTerms(){
  const div=document.getElementById("termButtons"); div.innerHTML="";
  const students=getStudents(); const studentData=students[currentStudent];
  for(let t in terms){
    const hasUnits=Object.values(studentData.allowedUnits[t]).some(v=>v);
    if(hasUnits){
      const btn=document.createElement("button");
      btn.className="term-section"; btn.innerText=`${t.toUpperCase()} Units`; btn.onclick=()=>loadTermUnits(t);
      div.appendChild(btn);
    }
  }
}

/* Load units per term */
function loadTermUnits(term){
  currentTerm=term; const div=document.getElementById("termButtons"); div.innerHTML="";
  const students=getStudents(); const studentData=students[currentStudent];
  terms[term].forEach(u=>{
    if(studentData.allowedUnits[term][u]){
      const btn=document.createElement("button"); btn.innerText=courseUnits[u]; btn.onclick=()=>startUnit(u); div.appendChild(btn);
    }
  });
  const back=document.createElement("button"); back.innerText="Back to Terms"; back.onclick=loadStudentTerms; div.appendChild(back);
}

/* ================= GAME ================= */
function startUnit(u){
  if(!questionBank[u]) return alert("No questions yet");
  currentUnitKey=u; currentUnitData=questionBank[u]; currentQuestionIndex=0; score=0;
  show("game"); showQuestion();
}

function showQuestion(){
  const q=currentUnitData[currentQuestionIndex];
  document.getElementById("unitTitle").innerText=courseUnits[currentUnitKey];
  document.getElementById("question").innerText=q.q;
  const div=document.getElementById("answers"); div.innerHTML="";
  shuffle(q.a); q.a.forEach(ans=>{ const btn=document.createElement("button"); btn.innerText=ans.text; btn.onclick=()=>checkAnswer(ans.correct); div.appendChild(btn); });
}

function checkAnswer(correct){
  if(correct) score+=20; currentQuestionIndex++;
  if(currentQuestionIndex<currentUnitData.length) showQuestion();
  else{
    const students=getStudents(); 
    students[currentStudent].scores[currentTerm]+=score;
    students[currentStudent].scores.total+=score;
    saveStudents(students); alert(`Unit complete! Score: ${score}`);
    show("studentMenu"); loadStudentTerms();
  }
}

/* ================= LEADERBOARD ================= */
function loadLeaderboard(){
  const div=document.getElementById("board"); div.innerHTML="";
  const students=getStudents(); 
  let arr=Object.keys(students).map(name=>({name,score:students[name].scores.total}));
  arr.sort((a,b)=>b.score-a.score);
  arr.forEach(s=>{ div.innerHTML+=`üèÜ ${s.name} : ${s.score} points<br>`; });
}

/* ================= SHUFFLE ================= */
function shuffle(array){ for(let i=array.length-1;i>0;i--){ const j=Math.floor(Math.random()*(i+1)); [array[i],array[j]]=[array[j],array[i]]; } }

</script>
</body>
</html>
