<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Earth & Space Science Classroom</title>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<style>
body{
margin:0;
font-family:Arial;
background:radial-gradient(circle at center,#000010,#000000);
color:white;
text-align:center;
}
.screen{display:none;padding:40px;}
.active{display:block;}
button,input{
padding:10px;
margin:10px;
border-radius:8px;
border:none;
}
button{background:#ff9800;cursor:pointer;}
button:hover{background:white;color:black;}
.card{
background:rgba(0,0,0,0.85);
padding:20px;
border-radius:15px;
max-width:650px;
margin:auto;
}
.answer{
display:block;
margin:10px auto;
width:80%;
padding:10px;
background:#111;
color:white;
border:1px solid orange;
}
.answer:hover{background:orange;color:black;}
table{margin:auto;background:black;padding:10px;}
</style>
</head>
<body>

<!-- LOGIN -->
<div id="login" class="screen active">
<h1>üåçüåå Earth & Space Science Game</h1>
<h2>Student Login</h2>
<input id="studentName" placeholder="Username">
<button onclick="studentLogin()">Login</button>
<p>Ask your teacher for your username.</p>
<button onclick="showTeacherLogin()">Teacher Login</button>
</div>

<!-- TEACHER LOGIN -->
<div id="teacherLogin" class="screen">
<h2>Teacher Login</h2>
<input id="teacherEmail" type="email" placeholder="Teacher Email">
<input id="teacherPass" type="password" placeholder="Password">
<button onclick="teacherLogin()">Login</button>
<button onclick="show('login')">Back</button>
</div>

<!-- DASHBOARD -->
<div id="dashboard" class="screen">
<h1>üë©‚Äçüè´ Teacher Dashboard</h1>

<h3>Create Students</h3>
<input id="newStudent" placeholder="Student username">
<button onclick="addStudent()">Add Student</button>

<h3>Unlock Topics for Students</h3>
<select id="selectStudent"></select><br>
<label><input type="checkbox" id="stage1"> Big Bang & Universe</label><br>
<label><input type="checkbox" id="stage2"> Earth Layers & Caves</label><br>
<label><input type="checkbox" id="stage3"> Volcanoes & Plate Tectonics</label><br>
<label><input type="checkbox" id="stage4"> Oceans & Trenches</label><br>
<label><input type="checkbox" id="stage5"> Solar System & Space Missions</label><br>
<label><input type="checkbox" id="stage6"> Rock Cycle</label><br>
<label><input type="checkbox" id="stage7"> Weather & Climate</label><br>
<label><input type="checkbox" id="stage8"> Earth Resources & Conservation</label><br>
<label><input type="checkbox" id="stage9"> Earthquakes & Plate Boundaries</label><br>
<button onclick="saveUnlocks()">Save Unlocks</button>

<h2>üèÜ Leaderboard</h2>
<div id="board"></div>
<button onclick="resetBoard()">Reset Leaderboard</button>
<button onclick="teacherLogout()">Logout</button>
</div>

<!-- STUDENT GAME -->
<div id="studentGame" class="screen">
<h1>üß≠ Choose a Topic</h1>
<div id="stageButtons"></div>
</div>

<div id="game" class="screen">
<div class="card">
<h2 id="stageTitle"></h2>
<p id="question"></p>
<div id="answers"></div>
<p>‚≠ê Score: <span id="score">0</span></p>
</div>
</div>

<script>
// ---------- FIREBASE CONFIG ----------
const firebaseConfig = {
  apiKey: "YOUR_API_KEY",
  authDomain: "YOUR_PROJECT_ID.firebaseapp.com",
  projectId: "YOUR_PROJECT_ID",
  storageBucket: "YOUR_PROJECT_ID.appspot.com",
  messagingSenderId: "YOUR_SENDER_ID",
  appId: "YOUR_APP_ID"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();
const auth = firebase.auth();

// ---------- GLOBAL VARIABLES ----------
let currentStudent="";
let score=0;
let currentStage=null;
let currentQuestionIndex=0;

// ---------- QUIZ DATA ----------
const stages = {
stage1:{title:"üí• Big Bang & Universe", questions:[
{q:"The Big Bang theory explains the origin of?", a:[{text:"The universe",correct:true},{text:"Earth",correct:false},{text:"Sun",correct:false}]},
{q:"The Cosmic Microwave Background is?", a:[{text:"Radiation from early universe",correct:true},{text:"A type of star",correct:false},{text:"Planetary dust",correct:false}]},
{q:"Edwin Hubble discovered galaxies are?", a:[{text:"Expanding away",correct:true},{text:"Stationary",correct:false},{text:"Collapsing",correct:false}]}
]},
stage2:{title:"üåé Earth Layers & Caves", questions:[
{q:"Which layer generates Earth's magnetic field?", a:[{text:"Outer Core",correct:true},{text:"Crust",correct:false},{text:"Mantle",correct:false}]},
{q:"Mammoth Cave is famous for?", a:[{text:"Longest cave system",correct:true},{text:"Deepest cave",correct:false},{text:"Oldest cave",correct:false}]},
{q:"Which is Earth's densest layer?", a:[{text:"Inner Core",correct:true},{text:"Crust",correct:false},{text:"Mantle",correct:false}]}
]},
stage3:{title:"üåã Volcanoes & Plate Tectonics", questions:[
{q:"Mauna Loa is what type of volcano?", a:[{text:"Shield",correct:true},{text:"Composite",correct:false},{text:"Cinder",correct:false}]},
{q:"Earthquakes occur mainly at?", a:[{text:"Plate boundaries",correct:true},{text:"Plate centers",correct:false},{text:"Inside continents",correct:false}]},
{q:"Ring of Fire is?", a:[{text:"Volcanic region around Pacific",correct:true},{text:"Volcanic region in Atlantic",correct:false}]}
]},
stage4:{title:"üåä Oceans & Trenches", questions:[
{q:"Mariana Trench formed by?", a:[{text:"Subduction",correct:true},{text:"Erosion",correct:false},{text:"Sedimentation",correct:false}]},
{q:"Largest ocean?", a:[{text:"Pacific",correct:true},{text:"Atlantic",correct:false},{text:"Indian",correct:false}]},
{q:"Ocean currents are caused by?", a:[{text:"Wind & rotation",correct:true},{text:"Earthquakes",correct:false},{text:"Tides only",correct:false}]}
]},
stage5:{title:"ü™ê Solar System & Space Missions", questions:[
{q:"Perseverance rover explores?", a:[{text:"Mars",correct:true},{text:"Venus",correct:false},{text:"Moon",correct:false}]},
{q:"Moon's surface is?", a:[{text:"Regolith",correct:true},{text:"Water",correct:false},{text:"Rocky soil",correct:false}]},
{q:"Sun is a?", a:[{text:"Star",correct:true},{text:"Planet",correct:false},{text:"Asteroid",correct:false}]}
]},
stage6:{title:"ü™® Rock Cycle", questions:[
{q:"Igneous rocks are formed by?", a:[{text:"Cooling of magma or lava",correct:true},{text:"Compression of sediments",correct:false},{text:"Metamorphism",correct:false}]},
{q:"Which type of rock can change into metamorphic rock?", a:[{text:"Igneous and sedimentary",correct:true},{text:"Only sedimentary",correct:false},{text:"Only igneous",correct:false}]},
{q:"Sedimentary rocks are formed mainly by?", a:[{text:"Accumulation and compression of sediments",correct:true},{text:"Melting and cooling",correct:false},{text:"Heat and pressure",correct:false}]}
]},
stage7:{title:"‚òÅÔ∏è Weather & Climate", questions:[
{q:"What drives Earth's weather?", a:[{text:"Sun's energy",correct:true},{text:"Moon's gravity",correct:false},{text:"Earthquakes",correct:false}]},
{q:"Climate is defined as?", a:[{text:"Average weather over time",correct:true},{text:"Daily weather",correct:false},{text:"Air pressure only",correct:false}]}
]},
stage8:{title:"üå± Earth Resources & Conservation", questions:[
{q:"Fossil fuels are?", a:[{text:"Nonrenewable resources",correct:true},{text:"Renewable resources",correct:false},{text:"Water sources",correct:false}]},
{q:"Recycling helps?", a:[{text:"Conserve resources",correct:true},{text:"Increase pollution",correct:false},{text:"Destroy ecosystems",correct:false}]}
]},
stage9:{title:"üåê Earthquakes & Plate Boundaries", questions:[
{q:"Where do most earthquakes occur?", a:[{text:"Plate boundaries",correct:true},{text:"Plate interiors",correct:false},{text:"Ocean centers",correct:false}]},
{q:"Seismic waves are?", a:[{text:"Energy waves from earthquakes",correct:true},{text:"Ocean waves",correct:false},{text:"Wind waves",correct:false}]}
]}
};

// ---------- UI FUNCTIONS ----------
function show(id){
    document.querySelectorAll(".screen").forEach(s=>s.classList.remove("active"));
    document.getElementById(id).classList.add("active");
}

// ---------- TEACHER LOGIN ----------
async function teacherLogin(){
    const email = document.getElementById("teacherEmail").value.trim();
    const pass = document.getElementById("teacherPass").value.trim();
    try {
        await auth.signInWithEmailAndPassword(email, pass);
        show("dashboard");
        loadStudents();
        loadLeaderboard();
    } catch(e) { alert("Login failed: "+e.message);}
}
function teacherLogout(){ auth.signOut(); show("login"); }

// ---------- STUDENT MANAGEMENT ----------
async function addStudent(){
    let name=document.getElementById("newStudent").value.trim();
    if(!name){alert("Enter username"); return;}
    const doc = db.collection("students").doc(name);
    const snapshot = await doc.get();
    if(!snapshot.exists){
        await doc.set({stage1:false, stage2:false, stage3:false, stage4:false, stage5:false, stage6:false, stage7:false, stage8:false, stage9:false, score:0});
        alert("Student added");
    } else { alert("Student already exists"); }
    document.getElementById("newStudent").value="";
    loadStudents();
}

async function loadStudents(){
    const select=document.getElementById("selectStudent");
    select.innerHTML="";
    const snapshot = await db.collection("students").get();
    snapshot.forEach(doc=>{
        let opt = document.createElement("option"); opt.value=doc.id; opt.text=doc.id; select.add(opt);
    });
    loadStudentUnlocks();
}

async function loadStudentUnlocks(){
    const s = document.getElementById("selectStudent").value;
    const doc = await db.collection("students").doc(s).get();
    if(doc.exists){
        const unlocks = doc.data();
        for(let i=1;i<=9;i++){ document.getElementById("stage"+i).checked = unlocks["stage"+i]||false; }
    }
}

async function saveUnlocks(){
    const s = document.getElementById("selectStudent").value;
    const unlocks = {};
    for(let i=1;i<=9;i++){ unlocks["stage"+i] = document.getElementById("stage"+i).checked; }
    await db.collection("students").doc(s).update(unlocks);
    alert("Unlocks saved for "+s);
}

// ---------- STUDENT LOGIN ----------
async function studentLogin(){
    const name = document.getElementById("studentName").value.trim();
    const doc = await db.collection("students").doc(name).get();
    if(!doc.exists){ alert("Username not found. Ask your teacher to create your account."); return; }
    currentStudent = name;
    loadStudentStages();
}

async function loadStudentStages(){
    const div=document.getElementById("stageButtons"); div.innerHTML="";
    const doc = await db.collection("students").doc(currentStudent).get();
    const unlocks = doc.data();
    for(let i=1;i<=9;i++){
        if(unlocks["stage"+i]){
            let btn=document.createElement("button");
            btn.innerText=stages["stage"+i].title;
            btn.onclick=()=>startStage("stage"+i);
            div.appendChild(btn);
        }
    }
    show("studentGame");
}

// ---------- GAME LOGIC ----------
function startStage(key){ score=0; currentQuestionIndex=0; currentStage=stages[key]; show("game"); showQuestion(); }
function showQuestion(){
    let q=currentStage.questions[currentQuestionIndex];
    document.getElementById("stageTitle").innerText=currentStage.title;
    document.getElementById("question").innerText=q.q;
    const div=document.getElementById("answers"); div.innerHTML="";
    q.a.forEach(a=>{
        let btn=document.createElement("button");
        btn.className="answer"; btn.innerText=a.text;
        btn.onclick=()=>checkAnswer(a.correct);
        div.appendChild(btn);
    });
}

async function checkAnswer(correct){
    if(correct) score+=20;
    currentQuestionIndex++;
    if(currentQuestionIndex<currentStage.questions.length){ showQuestion(); }
    else { await saveScore(); alert("Topic Complete! Score: "+score); loadStudentStages(); }
}

async function saveScore(){
    const docRef = db.collection("students").doc(currentStudent);
    const doc = await docRef.get();
    const prevScore = doc.data().score || 0;
    await docRef.update({score: prevScore+score});
    loadLeaderboard();
}

// ---------- LEADERBOARD ----------
async function loadLeaderboard(){
    const snapshot = await db.collection("students").get();
    let html="<table><tr><th>Name</th><th>Score</th></tr>";
    snapshot.forEach(doc=>{ html+="<tr><td>"+doc.id+"</td><td>"+(doc.data().score||0)+"</td></tr>"; });
    html+="</table>";
    document.getElementById("board").innerHTML=html;
}

async function resetBoard(){
    const snapshot = await db.collection("students").get();
    for(const doc of snapshot.docs){ await db.collection("students").doc(doc.id).update({score:0}); }
    loadLeaderboard();
}
</script>
</body>
</html>
