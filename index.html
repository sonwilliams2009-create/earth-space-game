<script>
/* ============================
   GLOBAL DATA
============================ */

let students = {};
let currentStudent = "";
let currentUnit = "";
let questionIndex = 0;
let score = 0;

/* ============================
   LOAD STUDENTS FROM GITHUB FILE
============================ */

async function loadStudents(){
  try{
    const res = await fetch("students.json");
    students = await res.json();
    console.log("Students loaded:", students);
  } catch(err){
    alert("‚ùå Could not load student database.");
    console.error(err);
  }
}

loadStudents();

/* ============================
   UNITS LIST
============================ */

const units = {
  unit1:"Unit 1: Big Bang & Universe",
  unit2:"Unit 2: Stars & Galaxies",
  unit3:"Unit 3: Solar System",
  unit4:"Unit 4: Gravity & Orbits",
  unit5:"Unit 5: Earth Layers",
  unit6:"Unit 6: Plate Tectonics",
  unit7:"Unit 7: Earthquakes",
  unit8:"Unit 8: Volcanoes",
  unit9:"Unit 9: Weather Systems",
  unit10:"Unit 10: Climate Change",
  unit11:"Unit 11: Oceans",
  unit12:"Unit 12: Natural Resources",
  unit13:"Unit 13: Human Impacts",
  unit14:"Unit 14: Moon & Tides",
  unit15:"Unit 15: Space Exploration",
  unit16:"Unit 16: Atmosphere",
  unit17:"Unit 17: Magnetic Field",
  unit18:"Unit 18: Rocks & Minerals",
  unit19:"Unit 19: Geologic Time",
  unit20:"Unit 20: Final Review"
};

/* ============================
   QUESTION BANK (FULL)
============================ */

const questionBank = {
unit1:[
 {q:"The Big Bang created‚Ä¶",a:["The Universe","Earth","The Sun"],correct:0},
 {q:"Universe age is about‚Ä¶",a:["13.8 billion years","1 million years","500 years"],correct:0}
],
unit6:[
 {q:"Divergent boundaries mean plates‚Ä¶",a:["Move apart","Collide","Stop"],correct:0},
 {q:"Ring of Fire surrounds‚Ä¶",a:["Pacific Ocean","Atlantic Ocean","Arctic"],correct:0}
],
unit20:[
 {q:"The Sun is a‚Ä¶",a:["Star","Planet","Comet"],correct:0}
]
};

/* ============================
   SCREEN CONTROL
============================ */

function showScreen(id){
  document.querySelectorAll(".screen").forEach(s=>s.style.display="none");
  document.getElementById(id).style.display="block";
}

/* ============================
   TEACHER LOGIN
============================ */

document.getElementById("teacherLoginBtn").onclick=()=>{
  if(document.getElementById("teacherPass").value==="caves"){
    showScreen("dashboard");
    refreshTeacherMenus();
  } else alert("Wrong password");
};

/* ============================
   TEACHER DROPDOWNS
============================ */

function refreshTeacherMenus(){
  let studentDrop=document.getElementById("studentSelect");
  studentDrop.innerHTML="";

  for(let s in students){
    let opt=document.createElement("option");
    opt.value=s;
    opt.textContent=s;
    studentDrop.appendChild(opt);
  }

  let unitDrop=document.getElementById("unitSelect");
  unitDrop.innerHTML="";

  for(let u in units){
    let opt=document.createElement("option");
    opt.value=u;
    opt.textContent=units[u];
    unitDrop.appendChild(opt);
  }

  loadLeaderboard();
}

/* ============================
   LEADERBOARD
============================ */

function loadLeaderboard(){
  let div=document.getElementById("leaderboard");
  div.innerHTML="";
  for(let s in students){
    div.innerHTML += `${s}: ${students[s].score} pts<br>`;
  }
}

/* ============================
   ASSIGN UNIT (READ ONLY)
============================ */

document.getElementById("assignUnitBtn").onclick=()=>{
  let student=document.getElementById("studentSelect").value;
  let unit=document.getElementById("unitSelect").value;

  alert(
`‚ö† GitHub Pages cannot auto-save assignments.

To assign this unit permanently, edit students.json:

"${student}": {
  "assignedUnit": "${unit}"
}`
  );
};

/* ============================
   STUDENT LOGIN
============================ */

document.getElementById("studentLoginBtn").onclick=()=>{
  let name=document.getElementById("studentName").value.trim();

  if(!students[name]) return alert("Student not found üò≠");

  currentStudent=name;
  currentUnit=students[name].assignedUnit;

  document.getElementById("assignedUnitText").innerText =
    units[currentUnit];

  showScreen("studentMenu");
};

/* ============================
   START UNIT
============================ */

document.getElementById("startUnitBtn").onclick=()=>{
  questionIndex=0;
  score=0;
  showScreen("quizScreen");
  showQuestion();
};

/* ============================
   QUIZ SYSTEM
============================ */

function showQuestion(){
  let questions=questionBank[currentUnit];
  if(!questions){
    alert("No questions yet.");
    showScreen("studentMenu");
    return;
  }

  let q=questions[questionIndex];

  document.getElementById("unitTitle").innerText =
    units[currentUnit];

  document.getElementById("questionText").innerText=q.q;

  let ansDiv=document.getElementById("answerButtons");
  ansDiv.innerHTML="";

  q.a.forEach((choice,index)=>{
    let btn=document.createElement("button");
    btn.innerText=choice;
    btn.onclick=()=>checkAnswer(index===q.correct);
    ansDiv.appendChild(btn);
  });
}

function checkAnswer(correct){
  alert(correct ? "Correct ‚úÖ" : "Wrong ‚ùå");

  questionIndex++;

  let questions=questionBank[currentUnit];

  if(questionIndex<questions.length){
    showQuestion();
  } else {
    alert("Unit Complete!");

    showScreen("studentMenu");
  }
}
</script>
